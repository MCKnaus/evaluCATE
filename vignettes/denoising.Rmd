---
title: "Denoise Terms"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Denoise Terms}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction
As described in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html), the estimation of the BLP and the GATES involves fitting suitable linear models via OLS.[^1] These regressions allow the inclusion of optional constructed covariates which are not necessary for identifying the targets but can significantly reduce the variance of the estimation. In this article, we discuss which covariates are incorporated in the regressions by the `evalue_cates` function.

The notation is the same as in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html).

There are several possible sets of constructed covariates that one can include in the regressions to reduce the variance of the estimation. Some of these sets have been proposed by Chernozukov et al. (2017), while others are new. For both the BLP and the GATES results, the `evalue_cates` function returns a bunch of fitted models, one for each of these sets. Thus, the user can compare the results across the different models.

The optional constructed covariates depend on the nuisance functions $\mu ( \cdot )$, $\mu_0 ( \cdot )$, $\mu_1 ( \cdot )$, and $p ( \cdot )$. The `evalue_cates` function constructs estimates of these functions internally using only the training sample and honest regression forests. Exception is the propensity score $p ( \cdot )$, which can be provided by the user.

Suppose that we assign the results of the `evalue_cates` function call to a variable called `evaluation`.

```{r call-main, eval = FALSE}
evaluation <- evalue_cates(y, D, X, cates, is_train = train_idx, pscore = pscore)
```

In the following, we list the additional covariates that are included in the fitted models returned by the `evalue_cates` function. 

### Weighted Residual
The `evalue_cates` function returns four different BLP and GATES models fitted using the weighted residual strategy.

- BLP:

  * `evaluation$BLP$wr_none` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html);
  * `evaluation$BLP$wr_cddf1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{\mu}_0 ( X_i )$;
  * `evaluation$BLP$wr_cddf2` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $1, \hat{\mu}_0 ( X_i ), p ( X_i ), p ( X_i ) \cdot \hat{\tau} ( X_i )$;
  * `evaluation$BLP$wr_mck1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{\mu} ( X_i )$.

- GATES:
  * `evaluation$GATES$wr_none` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html);
  * `evaluation$GATES$wr_cddf1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{\mu}_0 ( X_i )$; 
  * `evaluation$GATES$wr_cddf2` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{\mu}_0 ( X_i ), p ( X_i ) \cdot \mathbb{1} (G_1), \dots, p ( X_i ) \cdot \mathbb{1} (G_K)$; 
  * `evaluation$GATES$wr_mck1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{\mu} ( X_i )$.
  
### Horvitz-Thompson 
The `evalue_cates` function returns six different BLP and GATES models fitted using the Horvitz-Thompson transformation strategy.

- BLP:
  * `evaluation$BLP$ht_none` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html);
  * `evaluation$BLP$ht_cddf1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot \hat{\mu}_0 ( X_i )$;
  * `evaluation$BLP$ht_cddf2` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot \hat{\mu}_0 ( X_i ), \hat{H}_i \cdot p ( X_i ), \hat{H}_i \cdot p ( X_i ) \cdot \hat{\tau} ( X_i )$;
  * `evaluation$BLP$ht_mck1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot \hat{\mu}_0 ( X_i ), \hat{H}_i \cdot [ 1 - p ( X_i ) ] \cdot \hat{\tau} ( X_i )$;
  * `evaluation$BLP$ht_mck2` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot p ( X_i ), \hat{H}_i \cdot p ( X_i ) \cdot \hat{\mu}_0 ( X_i ), \hat{H}_i \cdot [ 1 - p ( X_i ) ] \cdot \hat{\mu}_1 ( X_i )$;
  * `evaluation$BLP$ht_mck3` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot p ( X_i ), \{ \hat{H}_i \cdot p ( X_i ) \cdot \hat{\mu}_0 ( X_i ) + \hat{H}_i \cdot [ 1 - p ( X_i ) ] \cdot \hat{\mu}_1 ( X_i ) \}$.

- GATES:
  * `evaluation$GATES$ht_none` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html);
  * `evaluation$GATES$ht_cddf1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus  $\hat{H}_i \cdot \hat{\mu}_0 ( X_i )$; 
  * `evaluation$GATES$ht_cddf2` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot \hat{\mu}_0 ( X_i ), \hat{H}_i \cdot p ( X_i ) \cdot \mathbb{1} (G_1), \dots, \hat{H}_i \cdot p ( X_i ) \cdot \mathbb{1} (G_K)$; 
  * `evaluation$GATES$ht_mck1` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot \hat{\mu}_0 ( X_i ), \hat{H}_i \cdot [ 1 - p ( X_i ) ] \cdot \hat{\tau} ( X_i )$; 
  * `evaluation$GATES$ht_mck2` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot p ( X_i ), \hat{H}_i \cdot p ( X_i ) \cdot \hat{\mu}_0 ( X_i ), \hat{H}_i \cdot [ 1 - p ( X_i ) ] \cdot \hat{\mu}_1 ( X_i )$; 
  * `evaluation$GATES$ht_mck3` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html) plus $\hat{H}_i \cdot p ( X_i ), \{ \hat{H}_i \cdot p ( X_i ) \cdot \hat{\mu}_0 ( X_i ) + \hat{H}_i \cdot [ 1 - p ( X_i ) ] \cdot \hat{\mu}_1 ( X_i ) \}$. 
  
### AIPW
The `evalue_cates` function returns only one BLP and GATES model fitted using the AIPW strategy.  

- BLP:
  * `evaluation$BLP$aipw` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html).
  
- GATES:
  * `evaluation$GATES$aipw` &rarr; The model discussed in the [short tutorial](https://riccardo-df.github.io/evalueCATEs/articles/evalue-cates-short-tutorial.html).
  
[^1]: The linear regressions are used for estimation purposes. The identification hinges on linear projections defined at the population level, with the linear regressions constituting their sample analogs.
